<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 PCA | 多變量分析（Multivariate Analysis）</title>
  <meta name="description" content="Chapter 1 PCA | 多變量分析（Multivariate Analysis）" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 PCA | 多變量分析（Multivariate Analysis）" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 PCA | 多變量分析（Multivariate Analysis）" />
  
  
  

<meta name="author" content="CWR" />


<meta name="date" content="2021-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="因素分析-factor-analysis.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>研究所上課筆記</a></li>
<li class="chapter" data-level="1" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>1</b> PCA</a>
<ul>
<li class="chapter" data-level="1.0.1" data-path="pca.html"><a href="pca.html#第一步標準化"><i class="fa fa-check"></i><b>1.0.1</b> 第一步：標準化</a></li>
<li class="chapter" data-level="1.0.2" data-path="pca.html"><a href="pca.html#eigenvalues-eigenvectors"><i class="fa fa-check"></i><b>1.0.2</b> eigenvalues、 eigenvectors</a></li>
<li class="chapter" data-level="1.0.3" data-path="pca.html"><a href="pca.html#線性組合"><i class="fa fa-check"></i><b>1.0.3</b> 線性組合</a></li>
<li class="chapter" data-level="1.0.4" data-path="pca.html"><a href="pca.html#主成分之組成"><i class="fa fa-check"></i><b>1.0.4</b> 主成分之組成</a></li>
<li class="chapter" data-level="1.0.5" data-path="pca.html"><a href="pca.html#看彼此關係"><i class="fa fa-check"></i><b>1.0.5</b> 看彼此關係</a></li>
<li class="chapter" data-level="1.1" data-path="pca.html"><a href="pca.html#直接用內建的-package-做"><i class="fa fa-check"></i><b>1.1</b> 直接用內建的 package 做</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="因素分析-factor-analysis.html"><a href="因素分析-factor-analysis.html"><i class="fa fa-check"></i><b>2</b> 因素分析 (Factor Analysis)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="因素分析-factor-analysis.html"><a href="因素分析-factor-analysis.html#作用"><i class="fa fa-check"></i><b>2.1</b> 作用</a></li>
<li class="chapter" data-level="2.2" data-path="因素分析-factor-analysis.html"><a href="因素分析-factor-analysis.html#模型"><i class="fa fa-check"></i><b>2.2</b> 模型</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a></li>
<li class="chapter" data-level="4" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>4</b> Applications</a>
<ul>
<li class="chapter" data-level="4.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>4.1</b> Example one</a></li>
<li class="chapter" data-level="4.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>4.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>5</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">多變量分析（Multivariate Analysis）</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pca" class="section level1" number="1">
<h1><span class="header-section-number">Chapter 1</span> PCA</h1>
<p>PCA 全名 Principal Component Analysis ，中文名字為主成分分析，主要是用來解決共線性以及變數過多的問題，這種方法十分基本也好用，所以廣受大家喜愛，路上隨便抓一個路人都會說他會做PCA，如果你現在不會的話也沒有關係，希望看完這個後大家會知道 PCA 的原理還有如何看分析結過。</p>
<p>以下會有一些數學算式，看不懂就算了其實沒關係，因為弄懂他並不會讓人生更快樂。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="pca.html#cb1-1" aria-hidden="true" tabindex="-1"></a>x.new <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">real =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;real&quot;</span>,<span class="dv">100</span>), <span class="fu">rep</span>(<span class="st">&quot;fake&quot;</span>,<span class="dv">100</span>)))</span>
<span id="cb1-2"><a href="pca.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#前一百筆是真鈔資料，後一百筆是假鈔資料。 </span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="pca.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">V1</th>
<th align="right">V2</th>
<th align="right">V3</th>
<th align="right">V4</th>
<th align="right">V5</th>
<th align="right">V6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">214.8</td>
<td align="right">131.0</td>
<td align="right">131.1</td>
<td align="right">9.0</td>
<td align="right">9.7</td>
<td align="right">141.0</td>
</tr>
<tr class="even">
<td align="right">214.6</td>
<td align="right">129.7</td>
<td align="right">129.7</td>
<td align="right">8.1</td>
<td align="right">9.5</td>
<td align="right">141.7</td>
</tr>
<tr class="odd">
<td align="right">214.8</td>
<td align="right">129.7</td>
<td align="right">129.7</td>
<td align="right">8.7</td>
<td align="right">9.6</td>
<td align="right">142.2</td>
</tr>
<tr class="even">
<td align="right">214.8</td>
<td align="right">129.7</td>
<td align="right">129.6</td>
<td align="right">7.5</td>
<td align="right">10.4</td>
<td align="right">142.0</td>
</tr>
<tr class="odd">
<td align="right">215.0</td>
<td align="right">129.6</td>
<td align="right">129.7</td>
<td align="right">10.4</td>
<td align="right">7.7</td>
<td align="right">141.8</td>
</tr>
<tr class="even">
<td align="right">215.7</td>
<td align="right">130.8</td>
<td align="right">130.5</td>
<td align="right">9.0</td>
<td align="right">10.1</td>
<td align="right">141.4</td>
</tr>
</tbody>
</table>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="fig/PCA/bank.PNG" alt="A caption" width="100%" />
<p class="caption">
Figure 1.1: A caption
</p>
</div>
<p>以上為<span class="math inline">\(X_1 \sim X_6\)</span>(<span class="math inline">\(V_1 \sim V_6\)</span>)的意思。（希望看得懂啦~）</p>
<p>接著要對他們做 PCA 的！一步一步慢慢來。</p>
<div id="第一步標準化" class="section level3" number="1.0.1">
<h3><span class="header-section-number">1.0.1</span> 第一步：標準化</h3>
<p><span class="math display">\[X_{std} = \frac{X-\mu}{\sigma}\]</span></p>
<p><span class="math display">\[\mathcal{X^*=C_nXD^{-1/2}}\]</span></p>
<p><span class="math inline">\(C_n\)</span> Cnetering Matrix：
這個矩陣的目的就是讓全部的<span class="math inline">\(X\)</span>都減去<span class="math inline">\(\bar{X}\)</span></p>
<p><span class="math display">\[C_n = I_n-\frac{1}{n}J_n\]</span>
<span class="math inline">\(J_n\)</span>為所有元素都是1的矩陣。</p>
<p>例如；
<span class="math display">\[C_2 = \begin{bmatrix}1 &amp;0 \\0 &amp; 1\end{bmatrix}-\frac{1}{2}\begin{bmatrix}1 &amp;1 \\1 &amp; 1\end{bmatrix} = \begin{bmatrix}\frac{1}{2} &amp;-\frac{1}{2}\\-\frac{1}{2} &amp; \frac{1}{2}\end{bmatrix}\]</span></p>
<p><span class="math inline">\(\mathcal{D}\)</span> 為對角線<span class="math inline">\(S_{x_i}{x_i}}\)</span>的對角矩陣。</p>
<p><span class="math inline">\(\lambda = (\lambda_1, \lambda_2, ...\lambda_p)\)</span> 為 <span class="math inline">\(\mathcal{X^*}&#39;\mathcal{X^*}\)</span>的 eigenvalues，<span class="math inline">\(\mathcal{V} = (v_1, v_2,...v_p)\)</span>是對應的 eigenvactors。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="pca.html#cb3-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">nrow</span>(x) <span class="co"># 幾個觀察值（幾張鈔票）</span></span>
<span id="cb3-2"><a href="pca.html#cb3-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ncol</span>(x) <span class="co"># 幾個獨立變量（總共觀察幾個東西）</span></span></code></pre></div>
<p><span class="math inline">\(C_n\)</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="pca.html#cb4-1" aria-hidden="true" tabindex="-1"></a>J_n <span class="ot">&lt;-</span>  <span class="fu">matrix</span>(<span class="dv">1</span>, n, n) <span class="co">#都是1的矩陣</span></span>
<span id="cb4-2"><a href="pca.html#cb4-2" aria-hidden="true" tabindex="-1"></a>I_n <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>,n,n)</span>
<span id="cb4-3"><a href="pca.html#cb4-3" aria-hidden="true" tabindex="-1"></a>C_n <span class="ot">&lt;-</span> I_n<span class="sc">-</span>(<span class="dv">1</span><span class="sc">/</span>n)<span class="sc">*</span>J_n</span></code></pre></div>
<p><span class="math inline">\(D^{-1/2}\)</span></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="pca.html#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(<span class="fu">sd</span>(x<span class="sc">$</span>V1)<span class="sc">^-</span><span class="dv">1</span>, <span class="fu">sd</span>(x<span class="sc">$</span>V2)<span class="sc">^-</span><span class="dv">1</span>, <span class="fu">sd</span>(x<span class="sc">$</span>V3)<span class="sc">^-</span><span class="dv">1</span>, <span class="fu">sd</span>(x<span class="sc">$</span>V4)<span class="sc">^-</span><span class="dv">1</span>, <span class="fu">sd</span>(x<span class="sc">$</span>V5)<span class="sc">^-</span><span class="dv">1</span>, <span class="fu">sd</span>(x<span class="sc">$</span>V6)<span class="sc">^-</span><span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="pca.html#cb6-1" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">=</span> (C_n <span class="sc">%*%</span> (<span class="fu">as.matrix</span>(x))<span class="sc">%*%</span> (d))</span>
<span id="cb6-2"><a href="pca.html#cb6-2" aria-hidden="true" tabindex="-1"></a>xs2 <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>(n<span class="dv">-1</span>))<span class="sc">*</span><span class="fu">t</span>(xs) <span class="sc">%*%</span> xs</span></code></pre></div>
</div>
<div id="eigenvalues-eigenvectors" class="section level3" number="1.0.2">
<h3><span class="header-section-number">1.0.2</span> eigenvalues、 eigenvectors</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="pca.html#cb7-1" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">=</span> <span class="fu">eigen</span>(xs2)  <span class="co"># spectral decomposition</span></span>
<span id="cb7-2"><a href="pca.html#cb7-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> eig<span class="sc">$</span>values</span>
<span id="cb7-3"><a href="pca.html#cb7-3" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">=</span> eig<span class="sc">$</span>vectors</span></code></pre></div>
<ul>
<li>直接使用</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="pca.html#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">scale</span>(x)</span>
<span id="cb8-2"><a href="pca.html#cb8-2" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">=</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(x))  <span class="co"># spectral decomposition</span></span>
<span id="cb8-3"><a href="pca.html#cb8-3" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> eig<span class="sc">$</span>values</span>
<span id="cb8-4"><a href="pca.html#cb8-4" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">=</span> eig<span class="sc">$</span>vectors</span></code></pre></div>
<p>其中eigenvectors彼此之間互相獨立（內積為零），也就是線性組合出來新的值不具共線性。</p>
<p>eigenvalues 表示該組合所含的變異，變異越多越好，表示可以將每個自變量的不同表示的越徹底，也就是說喪失的資訊量越少，所以eigenvalues都從大的開始挑，通常挑到可以解釋的百分之七八十（看自己定義啦，社會科學要求較低，約七八十就可以，畢竟人很複雜的；但是工業統計就會要求很高，通常要九十以上。）</p>
<p>要如何看包含的變異呢，通常就是以下這個公式：</p>
<p><span class="math display">\[
 \lambda_1\ \geq\lambda_2 \geq ...\geq\lambda_p\ ; \ 
 V = \frac{\sum_{i=1}^k\lambda_i}{\sum_{i=1}^p\lambda_i}\ ; \ k \leq p
 \]</span></p>
<p>當這個數值達到你要的變異量(<span class="math inline">\(V\)</span>)的最小的k，就是你要的<span class="math inline">\(\lambda\)</span>的量。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="pca.html#cb9-1" aria-hidden="true" tabindex="-1"></a>lambda.sum <span class="ot">&lt;-</span> lambda <span class="sc">%&gt;%</span> sum</span>
<span id="cb9-2"><a href="pca.html#cb9-2" aria-hidden="true" tabindex="-1"></a>lambda.dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>p),</span>
<span id="cb9-3"><a href="pca.html#cb9-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lambda =</span> lambda, </span>
<span id="cb9-4"><a href="pca.html#cb9-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cum =</span><span class="fu">cumsum</span>(lambda<span class="sc">/</span>lambda.sum))</span>
<span id="cb9-5"><a href="pca.html#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="pca.html#cb9-6" aria-hidden="true" tabindex="-1"></a>lambda.dt <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)<span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X</th>
<th align="right">lambda</th>
<th align="right">cum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2.946</td>
<td align="right">0.491</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1.278</td>
<td align="right">0.704</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.869</td>
<td align="right">0.849</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.450</td>
<td align="right">0.924</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.269</td>
<td align="right">0.969</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.189</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="pca.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lambda.dt)<span class="sc">+</span></span>
<span id="cb10-2"><a href="pca.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>p), <span class="at">y =</span> cum))<span class="sc">+</span></span>
<span id="cb10-3"><a href="pca.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>p), <span class="at">y =</span> cum, <span class="at">group =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb10-4"><a href="pca.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">1.02</span>))<span class="sc">+</span></span>
<span id="cb10-5"><a href="pca.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;lambda&quot;</span>,</span>
<span id="cb10-6"><a href="pca.html#cb10-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;累加&quot;</span>)</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" />
由上方表格可以看出，到第三個eigenvalue 就已經解釋變異的量就已經達到 80%，所以我們就決定使用<span class="math inline">\(\lambda_1,\lambda_2,\lambda_3\)</span> ，那他對應的eigenvector 分別為：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="pca.html#cb11-1" aria-hidden="true" tabindex="-1"></a>gamma[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>##              [,1]        [,2]        [,3]
## [1,] -0.006987029  0.81549497 -0.01768066
## [2,]  0.467758161  0.34196711  0.10338286
## [3,]  0.486678705  0.25245860  0.12347472
## [4,]  0.406758327 -0.26622878  0.58353831
## [5,]  0.367891118 -0.09148667 -0.78757147
## [6,] -0.493458317  0.27394074  0.11387536</code></pre>
</div>
<div id="線性組合" class="section level3" number="1.0.3">
<h3><span class="header-section-number">1.0.3</span> 線性組合</h3>
<p>重新經過線性組合的變量為：</p>
<p><span class="math display">\[y_i = Xv_i\]</span></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="pca.html#cb13-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(x) <span class="sc">%*%</span> gamma[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb13-2"><a href="pca.html#cb13-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb13-3"><a href="pca.html#cb13-3" aria-hidden="true" tabindex="-1"></a>y <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##           V1          V2         V3
## 1  1.7430272  1.64669605  1.4201973
## 2 -2.2686248 -0.53744461  0.5313151
## 3 -2.2717009 -0.10740754  0.7156191
## 4 -2.2778385 -0.08743490 -0.6041176
## 5 -2.6255397  0.03909779  3.1883837
## 6  0.7565089  3.08101359  0.7845117</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="pca.html#cb15-1" aria-hidden="true" tabindex="-1"></a>y.new <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">real =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;real&quot;</span>,<span class="dv">100</span>), <span class="fu">rep</span>(<span class="st">&quot;fake&quot;</span>,<span class="dv">100</span>)))</span></code></pre></div>
</div>
<div id="主成分之組成" class="section level3" number="1.0.4">
<h3><span class="header-section-number">1.0.4</span> 主成分之組成</h3>
<p>用圖形可以看一下主成分的組成，首先</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="pca.html#cb16-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">=</span> eig<span class="sc">$</span>vectors</span>
<span id="cb16-2"><a href="pca.html#cb16-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">=</span> <span class="fu">add_column</span>(gamma <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>(), <span class="at">V0 =</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>,<span class="st">&quot;X2&quot;</span>,<span class="st">&quot;X3&quot;</span>,<span class="st">&quot;X4&quot;</span>,<span class="st">&quot;X5&quot;</span>,<span class="st">&quot;X6&quot;</span>), <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb16-3"><a href="pca.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="pca.html#cb16-4" aria-hidden="true" tabindex="-1"></a>gamma<span class="fl">.01</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC =</span> <span class="fu">as.character</span>(),<span class="at">V0 =</span> <span class="fu">as.character</span>(),<span class="at">loading =</span> <span class="fu">as.numeric</span>() )</span>
<span id="cb16-5"><a href="pca.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gamma) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;V0&quot;</span>, <span class="fu">rep</span>(<span class="st">&quot;loading&quot;</span>, <span class="dv">6</span>))</span>
<span id="cb16-6"><a href="pca.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="pca.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb16-8"><a href="pca.html#cb16-8" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> gamma[,<span class="fu">c</span>(<span class="dv">1</span>,i<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb16-9"><a href="pca.html#cb16-9" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">add_column</span>(a, <span class="at">PC =</span> <span class="fu">rep</span>(i, <span class="fu">nrow</span>(a)),  <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb16-10"><a href="pca.html#cb16-10" aria-hidden="true" tabindex="-1"></a>  gamma<span class="fl">.01</span> <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gamma<span class="fl">.01</span>, a)</span>
<span id="cb16-11"><a href="pca.html#cb16-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-12"><a href="pca.html#cb16-12" aria-hidden="true" tabindex="-1"></a>gamma<span class="fl">.01</span>[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(gamma<span class="fl">.01</span>[,<span class="dv">1</span>]) </span>
<span id="cb16-13"><a href="pca.html#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="pca.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="pca.html#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(gamma<span class="fl">.01</span>)<span class="sc">+</span></span>
<span id="cb16-16"><a href="pca.html#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>( <span class="at">x =</span> V0, <span class="at">y=</span>loading, <span class="at">color =</span> PC))<span class="sc">+</span></span>
<span id="cb16-17"><a href="pca.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>( <span class="at">x =</span> V0, <span class="at">y=</span>loading, <span class="at">color =</span> PC, <span class="at">group =</span>PC), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb16-18"><a href="pca.html#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span><span class="dv">0</span>), <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>上圖為每個原始變數在每個主成分的所佔的比重，可以看出X1在第一主成分幾乎等於零，而影響第一主成分比重最高的是X4（正的）與X6(負的)。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="pca.html#cb17-1" aria-hidden="true" tabindex="-1"></a>PC12 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb17-2"><a href="pca.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb17-3"><a href="pca.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC1&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PC2&quot;</span>)</span>
<span id="cb17-4"><a href="pca.html#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="pca.html#cb17-5" aria-hidden="true" tabindex="-1"></a>PC13 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb17-6"><a href="pca.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V3, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb17-7"><a href="pca.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC1&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PC3&quot;</span>)</span>
<span id="cb17-8"><a href="pca.html#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="pca.html#cb17-9" aria-hidden="true" tabindex="-1"></a>PC23 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb17-10"><a href="pca.html#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> V2, <span class="at">y =</span> V3, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb17-11"><a href="pca.html#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC2&quot;</span>, <span class="at">y =</span> <span class="st">&quot;PC3&quot;</span>)</span>
<span id="cb17-12"><a href="pca.html#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="pca.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="pca.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(PC12 , PC13, PC23 , <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>上圖可以看出，用 PC1、PC2 保存了大部分的變異，也就是說只要用到 <span class="math inline">\(y_1、y_2\)</span> 就可以分辨大部份的真鈔和假鈔。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="pca.html#cb21-1" aria-hidden="true" tabindex="-1"></a>PC1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb21-2"><a href="pca.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb21-3"><a href="pca.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC1&quot;</span>)</span>
<span id="cb21-4"><a href="pca.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="pca.html#cb21-5" aria-hidden="true" tabindex="-1"></a>PC2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb21-6"><a href="pca.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> V2, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb21-7"><a href="pca.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC2&quot;</span>)</span>
<span id="cb21-8"><a href="pca.html#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="pca.html#cb21-9" aria-hidden="true" tabindex="-1"></a>PC3 <span class="ot">&lt;-</span><span class="fu">ggplot</span>(y.new)<span class="sc">+</span></span>
<span id="cb21-10"><a href="pca.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> V3, <span class="at">color =</span> real))<span class="sc">+</span></span>
<span id="cb21-11"><a href="pca.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC3&quot;</span>)</span>
<span id="cb21-12"><a href="pca.html#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="pca.html#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(PC1 , PC2, PC3 , <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: position_stack requires non-overlapping x intervals

## Warning: position_stack requires non-overlapping x intervals</code></pre>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>上面三張圖可以看到其實PC1就分辨真鈔與偽鈔，PC2也可以分辨大部分的真鈔偽鈔，但是表現沒有PC1優秀，而PC3則是一團亂。</p>
</div>
<div id="看彼此關係" class="section level3" number="1.0.5">
<h3><span class="header-section-number">1.0.5</span> 看彼此關係</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="pca.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb23-2"><a href="pca.html#cb23-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> gamma[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb23-3"><a href="pca.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_column</span>(b, <span class="at">V0 =</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span>,<span class="st">&quot;X2&quot;</span>,<span class="st">&quot;X3&quot;</span>,<span class="st">&quot;X4&quot;</span>,<span class="st">&quot;X5&quot;</span>,<span class="st">&quot;X6&quot;</span>), <span class="at">.before =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##   V0.1 V0      loading   loading.1
## 1   X1 X1 -0.006987029  0.81549497
## 2   X2 X2  0.467758161  0.34196711
## 3   X3 X3  0.486678705  0.25245860
## 4   X4 X4  0.406758327 -0.26622878
## 5   X5 X5  0.367891118 -0.09148667
## 6   X6 X6 -0.493458317  0.27394074</code></pre>
<div id="相關係數" class="section level4" number="1.0.5.1">
<h4><span class="header-section-number">1.0.5.1</span> 相關係數</h4>
以下算式為Y和X的相關係數，其中 <span class="math inline">\(g_{i}\)</span> 為 <span class="math inline">\(\gamma_{i}\)</span> (eigenvector)
的估計值，而<span class="math inline">\(l_i\)</span>為<span class="math inline">\(\lambda_i\)</span>的估計值。
<div class="figure"><span id="fig:unnamed-chunk-21"></span>
<img src="fig/PCA/rho%20of%20xy.PNG" alt="A caption" width="100%" />
<p class="caption">
Figure 1.2: A caption
</p>
</div>
<p>注意：
<span class="math display">\[
\sum^p_{j=1}r_{X_iY_j}^2 = \frac{\sum^p_{j=1}l_jg_{ij}^2}{S_{X_iX_i}}= \frac{S_{X_iX_i}}{S_{X_iX_i}}=1
\]</span></p>
<p>如果以這個例子我們只用前面兩個主成分的話，<span class="math inline">\(r_{X_iY_1}^2+r_{X_iY_2}^2\)</span> 為第<span class="math inline">\(X_i\)</span> 的變數被轉換成 <span class="math inline">\(Y_1、Y_2\)</span> 這兩個主成分後可以解釋的比例，接近1表示 <span class="math inline">\(X_i\)</span> 差不多被<span class="math inline">\(Y_1、Y_2\)</span> 解釋完了。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="pca.html#cb25-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> eig<span class="sc">$</span>vectors <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb25-2"><a href="pca.html#cb25-2" aria-hidden="true" tabindex="-1"></a>lambda.m <span class="ot">&lt;-</span> <span class="fu">diag</span>(lambda.dt<span class="sc">$</span>lambda <span class="sc">%&gt;%</span> sqrt) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb25-3"><a href="pca.html#cb25-3" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> gamma <span class="sc">%*%</span> lambda.m</span>
<span id="cb25-4"><a href="pca.html#cb25-4" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>p),</span>
<span id="cb25-5"><a href="pca.html#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">ri1 =</span> R[,<span class="dv">1</span>],</span>
<span id="cb25-6"><a href="pca.html#cb25-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">ri2 =</span> R[,<span class="dv">2</span>],</span>
<span id="cb25-7"><a href="pca.html#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">ri1.2ri2.2=</span>(R[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>R[,<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>)) </span>
<span id="cb25-8"><a href="pca.html#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="pca.html#cb25-9" aria-hidden="true" tabindex="-1"></a>R</span></code></pre></div>
<pre><code>##   X         ri1        ri2 ri1.2ri2.2
## 1 1 -0.01199158  0.9219364  0.8501105
## 2 2  0.80279596  0.3866019  0.7939424
## 3 3  0.83526859  0.2854104  0.7791327
## 4 4  0.69810421 -0.3009779  0.5779372
## 5 5  0.63139786 -0.1034278  0.4093606
## 6 6 -0.84690418  0.3096965  0.8131586</code></pre>
<p>ri1 這一行表示<span class="math inline">\(y_1\)</span>與<span class="math inline">\(x_i\)</span>的關係，這裡的關係都是相對的不是絕對，這裡可以看到<span class="math inline">\(x_1\)</span>和<span class="math inline">\(y_1\)</span>的關係很少，近乎零，<span class="math inline">\(x_2\)</span>和<span class="math inline">\(y_1\)</span>的相關係數為0.802796，很接近1，表示<span class="math inline">\(y_2\)</span>和<span class="math inline">\(x_2\)</span>有很大的關係。</p>
<p>先只看PC1與PC2兩個的關係</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="pca.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gcookbook)</span></code></pre></div>
<pre><code>## Warning: package &#39;gcookbook&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="pca.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code></pre></div>
<pre><code>## Warning: package &#39;ggrepel&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="pca.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 為了畫圓圈</span></span>
<span id="cb31-2"><a href="pca.html#cb31-2" aria-hidden="true" tabindex="-1"></a>circleFun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">center =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">diameter =</span> <span class="dv">1</span>, <span class="at">npoints =</span> <span class="dv">100</span>){</span>
<span id="cb31-3"><a href="pca.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> diameter <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb31-4"><a href="pca.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="sc">*</span>pi,<span class="at">length.out =</span> npoints)</span>
<span id="cb31-5"><a href="pca.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> center[<span class="dv">1</span>] <span class="sc">+</span> r <span class="sc">*</span> <span class="fu">cos</span>(tt)</span>
<span id="cb31-6"><a href="pca.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">&lt;-</span> center[<span class="dv">2</span>] <span class="sc">+</span> r <span class="sc">*</span> <span class="fu">sin</span>(tt)</span>
<span id="cb31-7"><a href="pca.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> xx, <span class="at">y =</span> yy))</span>
<span id="cb31-8"><a href="pca.html#cb31-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-9"><a href="pca.html#cb31-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-10"><a href="pca.html#cb31-10" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">circleFun</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">diameter =</span><span class="dv">2</span>,<span class="at">npoints =</span> <span class="dv">100</span>) <span class="co">#diameter:直徑；c(0,0):圓心</span></span>
<span id="cb31-11"><a href="pca.html#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="pca.html#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="pca.html#cb31-13" aria-hidden="true" tabindex="-1"></a>cor<span class="fl">.12</span>_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(R)<span class="sc">+</span></span>
<span id="cb31-14"><a href="pca.html#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ri1, <span class="at">y =</span> ri2))<span class="sc">+</span></span>
<span id="cb31-15"><a href="pca.html#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">x =</span> ri1, <span class="at">y =</span> ri2,<span class="at">label =</span> X), <span class="at">size =</span> <span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb31-16"><a href="pca.html#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(dat,<span class="at">mapping=</span><span class="fu">aes</span>(x,y))<span class="sc">+</span></span>
<span id="cb31-17"><a href="pca.html#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span><span class="dv">0</span>), <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb31-18"><a href="pca.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="dv">0</span>), <span class="at">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb31-19"><a href="pca.html#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="pca.html#cb31-20" aria-hidden="true" tabindex="-1"></a>cor<span class="fl">.12</span>_plot</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-23-1.png" width="864" /></p>
<p>該變量離圓心越遠，也就是<span class="math inline">\(\sqrt{r_{X_iY_i}^2}\)</span> 越大，就表示 PC1 與 PC2 可以解釋該變量越多。</p>
<p>但是這張圖真的很厲害，不只可以看出x與y之間的關係，也可以看出x之間的關係。</p>
<div class="figure"><span id="fig:unnamed-chunk-24"></span>
<img src="fig/PCA/corxx.PNG" alt="A caption" width="100%" />
<p class="caption">
Figure 1.3: A caption
</p>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="pca.html#cb32-1" aria-hidden="true" tabindex="-1"></a>cor<span class="fl">.12</span>_plot<span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">data =</span> R, <span class="fu">aes</span>(<span class="at">xend =</span> R[ ,<span class="dv">2</span>], <span class="at">yend=</span>R[ ,<span class="dv">3</span>]),</span>
<span id="cb32-2"><a href="pca.html#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="dv">0</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb32-3"><a href="pca.html#cb32-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">angle=</span><span class="dv">25</span>, <span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;cm&quot;</span>)))</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-25-1.png" width="864" /></p>
<p>從上面的式子可以知道，x之間的關係和上圖中兩個變數之間的夾角的cos值，例如<span class="math inline">\(X_4、X_6\)</span>的夾角機乎是180度，所以他們的<span class="math inline">\(r_{X_4X_6}\)</span> 就很接近<span class="math inline">\(cos\pi= -1\)</span>，表示兩個為負相關，而如果兩個變數的夾角為直角90度，他們的<span class="math inline">\(r\)</span>為0，就是兩者不相關，而如果兩個變數很靠近(例如2和3這一組或是4和5這一)就表示兩者的關係很大，接近1。</p>
<p>請注意，因為PC1 與PC2 只可以解釋全部變異中的70%左右，因此所說的<span class="math inline">\(r_{X_iX_j}\)</span>是在這70%中的變異中所呈現的關係，不能代表全部的關係。</p>
</div>
</div>
<div id="直接用內建的-package-做" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> 直接用內建的 package 做</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="pca.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code></pre></div>
<pre><code>## Warning: package &#39;ggfortify&#39; was built under R version 4.0.3</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="pca.html#cb35-1" aria-hidden="true" tabindex="-1"></a>pca_res <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(x, <span class="at">scale=</span> T)</span>
<span id="cb35-2"><a href="pca.html#cb35-2" aria-hidden="true" tabindex="-1"></a>pca_res<span class="sc">$</span>sdev <span class="co">#其中 pca_res$sdev 的平方 = lambda</span></span></code></pre></div>
<pre><code>## [1] 1.7162629 1.1305237 0.9322192 0.6706480 0.5183405 0.4346031</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="pca.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_res, <span class="at">data =</span> x.new, <span class="at">colour =</span> <span class="st">&#39;real&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: `select_()` was deprecated in dplyr 0.7.0.
## Please use `select()` instead.</code></pre>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="pca.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_res, <span class="at">data =</span> x.new, <span class="at">colour =</span> <span class="st">&#39;real&#39;</span>,<span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>,)</span></code></pre></div>
<p><img src="Multivariate-Analysis_files/figure-html/unnamed-chunk-28-1.png" width="672" />
看到圖不一樣不要緊張，因為向量可能全部差一個負號。</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="因素分析-factor-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Multivariate Analysis.pdf", "Multivariate Analysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
